name: Content to product pipeline
on: [push]
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    services:
      mysql:
        image: mysql:5.7
        env:
          MYSQL_DATABASE: wordpress_test
          MYSQL_USER: wordpress_test
          MYSQL_HOST: localhost
          MYSQL_PASSWORD: wordpress_test
          MYSQL_ROOT_PASSWORD: wordpress_test
        ports:
          - 33306:3306
        options: --health-cmd="mysqladmin ping" --health-interval=10s --health-timeout=5s --health-retries=3
    steps:
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: 7.4
      - name: Check out repository code
        uses: actions/checkout@v2
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
      - name: Install composer
        run: |
          composer install
      - name: Code Formating
        run: |
          chmod +x ${{ github.workspace }}/vendor/bin/phpcbf
          ${{ github.workspace }}/vendor/bin/phpcbf
      - name: Code Sniffing
        run: |
          chmod +x ${{ github.workspace }}/vendor/bin/phpcs
          ${{ github.workspace }}/vendor/bin/phpcs
      - name: Unit Testing
        run: |
          bash ${{ github.workspace }}/bin/install-wp-tests.sh wordpress_test wordpress_test 'wordpress_test' 0.0.0.0:33306
          chmod +x ${{ github.workspace }}/vendor/bin/phpunit
          ${{ github.workspace }}/vendor/bin/phpunit
      - name: Deleting Test folder
        run: |
          rm -vrf ${{ github.workspace }}/tests
      - name:  Deleting bin folder
        run: |
          rm -vrf ${{ github.workspace }}/bin
          export COMPOSER_PROCESS_TIMEOUT=60
      - name:  Deleting files
        run: |
          rm -vf ${{ github.workspace }}/.phpcs.xml.dist
          rm -vf ${{ github.workspace }}/phpunit.xml.dist
          rm -vf ${{ github.workspace }}/.composer.json
      - name:  Deleting github folder
        run: |
          rm -vrf ${{ github.workspace }}/.github
      - run: echo "üçè This job's status is ${{ job.status }}."
